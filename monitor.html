<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roastmaster RDP Monitor</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; border: 1px solid #333; padding: 20px; background: #000; }
        h1 { border-bottom: 1px solid #00ff00; padding-bottom: 10px; }
        .stat-box { margin-bottom: 20px; }
        .label { color: #888; }
        .value { font-weight: bold; color: #fff; }
        pre { background: #111; padding: 10px; border: 1px solid #333; white-space: pre-wrap; word-wrap: break-word; }
        .status-dot { height: 10px; width: 10px; background-color: #555; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .active { background-color: #00ff00; box-shadow: 0 0 5px #00ff00; }
    </style>
</head>
<body>

<div class="container">
    <h1><span id="activity" class="status-dot"></span>RDP Packet Monitor</h1>
    
    <div class="stat-box">
        <div><span class="label">Host Serial:</span> <span id="serial" class="value">Waiting...</span></div>
        <div><span class="label">Last Updated:</span> <span id="timestamp" class="value">--</span></div>
        <div><span class="label">Epoch ID:</span> <span id="epoch" class="value">--</span></div>
        <div><span class="label">Event Type:</span> <span id="eventType" class="value">--</span></div>
    </div>

    <h3>Raw Packet Payload</h3>
    <pre id="rawPayload">Waiting for data...</pre>
</div>

<script>
    const EVENT_TYPES = { 1: "SYN", 2: "ACK", 3: "TEMP" };

    async function updateData() {
        try {
            // Read the JSON file generated by Python
            const response = await fetch('rdp_packet.json?nocache=' + new Date().getTime());
            
            if (!response.ok) throw new Error("File not found");
            
            const data = await response.json();

            // Update Header Info
            document.getElementById('serial').textContent = data.RPSerial;
            document.getElementById('timestamp').textContent = data.LocalTimestamp;
            document.getElementById('epoch').textContent = data.RPEpoch;
            
            // Parse Payload String back to JSON object for easier reading
            let payloadObj = [];
            let eventTypeStr = "Unknown";
            
            try {
                payloadObj = JSON.parse(data.RPPayload);
                const typeCode = payloadObj[0].RPEventType;
                eventTypeStr = EVENT_TYPES[typeCode] || "Unknown (" + typeCode + ")";
            } catch (e) {
                payloadObj = "Error parsing payload JSON";
            }

            document.getElementById('eventType').textContent = eventTypeStr;

            // Display formatted JSON
            document.getElementById('rawPayload').textContent = JSON.stringify(payloadObj, null, 2);

            // Blink effect
            const dot = document.getElementById('activity');
            dot.classList.add('active');
            setTimeout(() => dot.classList.remove('active'), 200);

        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    // Poll every 1 second
    setInterval(updateData, 1000);
    updateData(); // Initial call
</script>

</body>
</html>
